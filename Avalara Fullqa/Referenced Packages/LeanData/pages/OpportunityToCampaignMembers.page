<apex:page sideBar="false" standardController="Opportunity" extensions="LeanData.OpportunityToCampaignMembersController" docType="html-5.0">
    <c:loadingBox />
    <style>
    .dateFormat{
        display:none;
    }
    .sectionHeader{
        background: #348FDA;
        color:white;
        height:25px;
        width:100%;
        font-weight:bold;
        font-size:110%;
        padding-left:10px;
        display: table; 
        overflow: hidden;
        vertical-align: center;
        margin-bottom:5px;
        margin-top:5px;
    }
    .centerSectionHeader{
        display: table-cell; 
        vertical-align: middle;
    }
    .statsTable{
        background: white;
        border: solid 1px gray;     
        border-collapse: collapse;   
    }
    .statsTable .statsHeader td{
        color: white;
    }
    .statsTable .statsHeader{
        background: #348FDA;
    }
    .statsTable tr td{
        border: solid 1px gray;   
        padding: 10px;     
    }
    </style>
    <apex:form >
        <img src="{!$Resource.leandata_logo}" class="leandata_logo_header" height="30px;" style="margin-bottom:5px;"/>
        <apex:pageBlock id="reportingOff" rendered="{!NOT(isReportingOn)}">
            <apex:outputPanel id="pageMessagePanel">
                    <apex:pageMessages />
            </apex:outputPanel>               
        </apex:pageBlock>
        <apex:outputPanel rendered="{!isReportingOn}">
            <apex:pageBlock title="Opportunity Selection" >
                <apex:pageBlockButtons location="bottom"> 
                    <apex:commandButton action="{!runInitialReport}" value="Run Initial Report" rerender="pageMessagePanel,resultsPanel" status="loadStatus"/>
                </apex:pageBlockButtons>
                <apex:outputPanel layout="block" style="width:300px;align:center;">           
                    <apex:inputField value="{!dummyOCM.LeanData__Opportunity__c}" style="width:300px;" onChange="selectOpportunityAF();" required="true"/>
    
                </apex:outputPanel>
            </apex:pageBlock>    
            <apex:outputPanel id="resultsPanel">
                <apex:pageBlock id="opportunityBlock" title="Opportunity Details" rendered="{!isInitialRun}">
                    <table class="statsTable" style="text-align:center">
                    <tr class="statsHeader"><td><b>Number of Related Campaigns</b></td><td><b>Created Date</b></td><td><b>Close Date</b></td><td><b>Stage</b></td><td><b>Amount</b></td><td><b>Owner</b></td></tr>
                    <tr>
                    <td><apex:outputText value="{!NumberofRelatedCampaigns}" /></td>
                    <td>
                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}">
                            <apex:param value="{!CreatedDate}" /> 
                        </apex:outputText>
                    </td>
                    <td><apex:outputField value="{!selectedOpportunity.CloseDate}" /></td>
                    <td><apex:outputField value="{!selectedOpportunity.StageName}" /></td>
                    <td><!--<apex:outputField value="{!selectedOpportunity.Amount}" />--></td> 
                    <td><apex:outputField value="{!selectedOpportunity.Owner.Name}" /></td>
                    </tr>
                    </table>
                </apex:pageBlock>
                <apex:pageBlock id="filterBlock" title="Set Filters" rendered="{!isInitialRun}">
                <apex:pageBlockButtons location="bottom">
                    <apex:commandButton action="{!runFilteredReport}" value="Filter Report" rerender="pageMessagePanel,resultsPanel" status="loadStatus"/>                
                </apex:pageBlockButtons>
                <ul>
                    <li>Found {!NumberOfContacts} Contacts connected to this Opportunity.</li>
                    <li>Found {!NumberOfLeads} Leads connected to this Opportunity.</li>
                    <li>Found {!numberOfContactWithRoles} Contacts with Roles connected to this Opportunity.</li>
                </ul>    
                
                <apex:outputPanel styleClass="sectionHeader" layout="block"> 
                    <apex:outputPanel styleClass="centerSectionHeader">
                        Select Dates
                    </apex:outputPanel>
                </apex:outputPanel> 
                
                <table>          
                    <tr><td><b>Start Date : </b></td><td><apex:inputField Value="{!dummyCampaignForDates.StartDate}" /></td></tr>
                    <tr><td><b>End Date : </b></td><td><apex:inputField Value="{!dummyCampaignForDates.EndDate}" /></td></tr>           
                </table>
                
                <apex:outputPanel styleClass="sectionHeader" layout="block"> 
                    <apex:outputPanel styleClass="centerSectionHeader">
                        Exclude Campaign Member Status
                    </apex:outputPanel>
                </apex:outputPanel> 
                
                <apex:outputPanel style="max-height:200px;overflow:auto;" layout="block" >
                    <apex:pageBlockTable value="{!campaignMemberStatusList}" var="L" id="CampaignMemberStatusTable" rendered="{!campaignMemberStatusList != null}" style="margin-bottom:10px;"  >
                        <apex:column headerValue="Exclude" > <apex:inputCheckbox value="{!L.isSelected}" /> </apex:column>
                        <apex:column headerValue="Campaign" value="{!L.Camp.Name}" />
                        <apex:column headerValue="Campaign Member Status" value="{!L.CMS.Label}" />
                        <apex:column headerValue="Occurances" value="{!L.NumberOfInstances}" />
                    </apex:pageBlockTable>
                </apex:outputPanel>
                
                <apex:outputPanel styleClass="sectionHeader" layout="block"> 
                    <apex:outputPanel styleClass="centerSectionHeader">
                        Exclude Lead Status
                    </apex:outputPanel>
                </apex:outputPanel> 
    
                <apex:pageBlockTable value="{!LeadStatusList}" var="L" id="LeadStatusTable" rendered="{!LeadStatusList != null}" style="margin-bottom:10px;">
                    <apex:column headerValue="Exclude" > <apex:inputCheckbox value="{!L.isSelected}" /> </apex:column>
                    <apex:column headerValue="Lead Status" value="{!L.LS.MasterLabel}" />
                    <apex:column headerValue="Occurances" value="{!L.NumberOfInstances}" />
                </apex:pageBlockTable>
                
                <apex:outputPanel styleClass="sectionHeader" layout="block"> 
                    <apex:outputPanel styleClass="centerSectionHeader">
                        Exclude Campaign Type
                    </apex:outputPanel>
                </apex:outputPanel> 
    
                <apex:pageBlockTable value="{!CampaignTypeList}" var="L" id="CampaignTypeTable" rendered="{!CampaignTypeList != null}" style="margin-bottom:10px;">
                    <apex:column headerValue="Exclude" > <apex:inputCheckbox value="{!L.isSelected}" /> </apex:column>
                    <apex:column headerValue="Campaign Type" value="{!L.CampaignType}" />
                    <apex:column headerValue="Occurances" value="{!L.NumberOfInstances}" />
                </apex:pageBlockTable>
                
                </apex:pageBlock>
                <apex:outputPanel id="pageMessagePanel">
                    <apex:pageMessages />
                </apex:outputPanel> 
                <apex:pageBlock id="resultsBlock" title="Results" rendered="{!isInitialRun}">
                    <apex:pageBlockButtons location="top">`
                        <apex:commandButton action="{!saveOpportunityToCampaignMembers}" value="Save Results" rerender="pageMessagePanel" status="loadStatus"/>                
                    </apex:pageBlockButtons>
                    <ul><li><b>{!TotalConnectedCampaignMembers} Campaign Members.</b></li></ul>
                    <apex:pageBlockTable value="{!opportunityCampaignMembers}" var="C" id="CampaignMembersTable" rendered="{!opportunityCampaignMembers != null}" style="margin-bottom:10px;">
                            <apex:column headerValue="Name" > <apex:outputText value="{!leadsMap[C.LeanData__Lead__c].Name}" rendered="{!C.LeanData__Lead__c != null}" /><apex:outputText value="{!contactsMap[C.LeanData__Contact__c].Name}" rendered="{!C.LeanData__Contact__c != null}" /> </apex:column>
                            <apex:column headerValue="Campaign" value="{!campaignsMap[C.LeanData__Campaign__c].Name}" />
                            <apex:column headerValue="Campaign Member Created Date" value="{!C.LeanData__Campaign_Member_Created_Date__c}">   </apex:column>
                            <apex:column headerValue="Campaign Member Status" value="{!C.LeanData__Campaign_Member_Status__c}" />
                            <apex:column headerValue="Campaign Start Date" value="{!campaignsMap[C.LeanData__Campaign__c].StartDate}" />
                            <apex:column headerValue="Title" ><apex:outputText value="{!leadsMap[C.LeanData__Lead__c].Title}" rendered="{!C.LeanData__Lead__c != null && leadsMap[C.LeanData__Lead__c].Title != null}" /><apex:outputText value="{!contactsMap[C.LeanData__Contact__c].Title}" rendered="{!C.LeanData__Contact__c != null}" /></apex:column>
                            <apex:column headerValue="Company" ><apex:outputText value="{!leadsMap[C.LeanData__Lead__c].Company}" rendered="{!C.LeanData__Lead__c != null}" /><apex:outputText value="{!contactsMap[C.LeanData__Contact__c].Account.Name}" rendered="{!C.LeanData__Contact__c != null}" /></apex:column>
                            <apex:column headerValue="Lead Status" ><apex:outputText value="{!leadsMap[C.LeanData__Lead__c].Status}" rendered="{!C.LeanData__Lead__c != null}" /></apex:column>
                            <apex:column headerValue="Contact Role" ><apex:outputText value="{!contactRoleMap[C.LeanData__Contact__c]}" rendered="{!(CONTAINS(contactWithRoleString, C.LeanData__Contact__c) && C.LeanData__Contact__c != null)}" /></apex:column>
                            <apex:column headerValue="Owner" ><apex:outputText value="{!leadsMap[C.LeanData__Lead__c].Owner.Name}" rendered="{!C.LeanData__Lead__c != null}" /><apex:outputText value="{!contactsMap[C.LeanData__Contact__c].Owner.Name}" rendered="{!C.LeanData__Contact__c != null}" /></apex:column>         
                            <!--          
                            <apex:column headerValue="Campaign Weight" >
                                <apex:outputText value="${0, number, ###,###,###,##0.00}">  
                                      <apex:param value="{!C.temp_Weighted_Campaign_Attribution__c}"/>  
                                 </apex:outputText> 
                            </apex:column>                   
                            <apex:column headerValue="Campaign Member Weight" >
                                <apex:outputText value="${0, number, ###,###,###,##0.00}">  
                                      <apex:param value="{!C.temp_Weighted_Campaign_Member_Attributio__c}"/>  
                                 </apex:outputText> 
                            </apex:column>  
                            -->
                    </apex:pageBlockTable>
                </apex:pageBlock>
            </apex:outputPanel>
        </apex:outputPanel>        
    </apex:form>
</apex:page>